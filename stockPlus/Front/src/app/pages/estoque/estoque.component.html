<app-layout>
  <div class="back-button-container">
    <button class="btn-back" (click)="voltarEstoques()">
      ‚Üê Voltar para Estoques
    </button>
  </div>
  <div class="estoque-container">
    <div class="resumo-cards">
      <div class="card">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <p class="card-label">Valor Total em Estoque</p>
          <p class="card-value">R$ {{ valorTotalEstoque | number: '1.2-2' }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üì¶</div>
        <div class="card-content">
          <p class="card-label">Quantidade Total de Itens</p>
          <p class="card-value">{{ quantidadeTotalItens }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üè∑Ô∏è</div>
        <div class="card-content">
          <p class="card-label">Total de Produtos</p>
          <p class="card-value">{{ totalProdutos }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üìä</div>
        <div class="card-content">
          <p class="card-label">Pre√ßo M√©dio Unit√°rio</p>
          <p class="card-value">R$ {{ precoMedioUnitario | number: '1.2-2' }}</p>
        </div>
      </div>
    </div>

    <div class="produtos-section">
      <div class="section-header">
        <h2>Meus Produtos</h2>
        <button class="btn btn-primary" (click)="abrirFormulario()">
          + Adicionar Produto
        </button>
      </div>

      <div *ngIf="isLoading" class="loading">
        <p>Carregando produtos...</p>
      </div>

      <div *ngIf="erro && !isLoading" class="alert alert-danger">
        {{ erro }}
      </div>

      <div *ngIf="!isLoading && produtos.length > 0" class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Fornecedor</th>
              <th>Marca</th>
              <th>Quantidade</th>
              <th>Pre√ßo Unit√°rio</th>
              <th>Descri√ß√£o</th>
              <th>Valor Total</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let produto of produtos">
              <td>{{ produto.nome }}</td>
              <td>{{ produto.fornecedor }}</td>
              <td>{{ produto.marca }}</td>
              <td class="quantity">{{ produto.quantidade }}</td>
              <td>R$ {{ produto.precoUnitario | number: '1.2-2' }}</td>
              <td class="description">{{ produto.descricao || '-' }}</td>
              <td class="total">R$ {{ calcularValorTotal(produto) | number: '1.2-2' }}</td>
              <td class="actions">
                <button class="btn-action btn-add" (click)="adicionarQuantidade(produto)" title="Adicionar quantidade">‚ûï</button>
                  <button class="btn-action btn-remove" (click)="removerQuantidade(produto)" title="Remover quantidade">‚ûñ</button>
                <button class="btn-action btn-edit" (click)="editarProduto(produto)" title="Editar">‚úèÔ∏è</button>
                <button class="btn-action btn-delete" (click)="deletarProduto(produto.id)" title="Deletar">üóëÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div *ngIf="!isLoading && produtos.length === 0" class="empty-state">
        <p>Nenhum produto cadastrado ainda.</p>
        <button class="btn btn-primary" (click)="abrirFormulario()">
          Adicionar Primeiro Produto
        </button>
      </div>
    </div>

    <div *ngIf="showFormModal" class="modal-overlay" (click)="fecharFormulario()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditMode ? 'Editar Produto' : 'Adicionar Novo Produto' }}</h3>
          <button class="btn-close" (click)="fecharFormulario()">‚úï</button>
        </div>

        <form class="modal-form">
          <div class="form-group">
            <label for="nome">Nome *</label>
            <input
              type="text"
              id="nome"
              class="form-control"
              [(ngModel)]="formData.nome"
              name="nome"
              placeholder="Nome do produto"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="fornecedor">Fornecedor *</label>
              <input
                type="text"
                id="fornecedor"
                class="form-control"
                [(ngModel)]="formData.fornecedor"
                name="fornecedor"
                placeholder="Fornecedor"
              />
            </div>

            <div class="form-group">
              <label for="marca">Marca *</label>
              <input
                type="text"
                id="marca"
                class="form-control"
                [(ngModel)]="formData.marca"
                name="marca"
                placeholder="Marca"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="quantidade">Quantidade</label>
              <input
                type="number"
                id="quantidade"
                class="form-control"
                [(ngModel)]="formData.quantidade"
                name="quantidade"
                placeholder="0"
              />
            </div>

            <div class="form-group">
              <label for="precoUnitario">Pre√ßo Unit√°rio</label>
              <input
                type="number"
                id="precoUnitario"
                class="form-control"
                [(ngModel)]="formData.precoUnitario"
                name="precoUnitario"
                placeholder="0.00"
                step="0.01"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="descricao">Descri√ß√£o</label>
            <textarea
              id="descricao"
              class="form-control"
              [(ngModel)]="formData.descricao"
              name="descricao"
              placeholder="Descri√ß√£o do produto"
              rows="3"
            ></textarea>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="fecharFormulario()">
              Cancelar
            </button>
            <button type="button" class="btn btn-primary" (click)="salvarProduto()">
              {{ isEditMode ? 'Atualizar' : 'Adicionar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</app-layout>
