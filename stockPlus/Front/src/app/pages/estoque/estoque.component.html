<app-layout>
  <div class="back-button-container">
    <button class="btn-back" (click)="voltarEstoques()">
      ‚Üê Voltar para Estoques
    </button>
  </div>
  <div class="estoque-container">
    <!-- Cards de Resumo -->
    <div class="resumo-cards">
      <div class="card">
        <div class="card-icon">üí∞</div>
        <div class="card-content">
          <p class="card-label">Valor Total em Estoque</p>
          <p class="card-value">R$ {{ valorTotalEstoque | number: '1.2-2' }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üì¶</div>
        <div class="card-content">
          <p class="card-label">Quantidade Total de Itens</p>
          <p class="card-value">{{ quantidadeTotalItens }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üè∑Ô∏è</div>
        <div class="card-content">
          <p class="card-label">Total de Produtos</p>
          <p class="card-value">{{ totalProdutos }}</p>
        </div>
      </div>

      <div class="card">
        <div class="card-icon">üìä</div>
        <div class="card-content">
          <p class="card-label">Pre√ßo M√©dio Unit√°rio</p>
          <p class="card-value">R$ {{ precoMedioUnitario | number: '1.2-2' }}</p>
        </div>
      </div>
    </div>

    <!-- Se√ß√£o de Produtos -->
    <div class="produtos-section">
      <div class="section-header">
        <h2>Meus Produtos</h2>
        <button class="btn btn-primary" (click)="abrirFormulario()">
          + Adicionar Produto
        </button>
      </div>

      <!-- Mensagem de Carregamento -->
      <div *ngIf="isLoading" class="loading">
        <p>Carregando produtos...</p>
      </div>

      <!-- Mensagem de Erro -->
      <div *ngIf="erro && !isLoading" class="alert alert-danger">
        {{ erro }}
      </div>

      <!-- Tabela de Produtos -->
      <div *ngIf="!isLoading && produtos.length > 0" class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Fornecedor</th>
              <th>Marca</th>
              <th>Quantidade</th>
              <th>Pre√ßo Unit√°rio</th>
              <th>Descri√ß√£o</th>
              <th>Valor Total</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of produtos">
              <td>{{ item.produto.nome }}</td>
              <td>{{ item.produto.fornecedor }}</td>
              <td>{{ item.produto.marca }}</td>
              <td class="quantity">{{ item.quantidade }}</td>
              <td>R$ {{ item.produto.precoUnitario | number: '1.2-2' }}</td>
              <td class="description">{{ item.produto.descricao || '-' }}</td>
              <td class="total">
                R$ {{ item.quantidade * item.produto.precoUnitario | number: '1.2-2' }}
              </td>

              <td class="actions">
                <button class="btn-action btn-add" (click)="adicionarQuantidade(item)">‚ûï</button>

                <button class="btn-action btn-remove" (click)="removerQuantidade(item)">‚ûñ</button>

                <button class="btn-action btn-edit" (click)="editarProduto(item)">‚úèÔ∏è</button>

                <button class="btn-action btn-delete" (click)="deletarProdutoEstoque(item.id!)">üóëÔ∏è</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensagem quando n√£o h√° produtos -->
      <div *ngIf="!isLoading && produtos.length === 0" class="empty-state">
        <p>Nenhum produto cadastrado ainda.</p>
        <button class="btn btn-primary" (click)="abrirFormulario()">
          Adicionar Primeiro Produto
        </button>
      </div>
    </div>

    <!-- Modal de Formul√°rio -->
    <div *ngIf="showFormModal" class="modal-overlay" (click)="fecharFormulario()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditMode ? 'Editar Produto' : 'Adicionar Novo Produto' }}</h3>
          <button class="btn-close" (click)="fecharFormulario()">‚úï</button>
        </div>

        <form class="modal-form">
          <div class="form-group">
            <label for="nome">Nome</label>
            <!-- NOME -->
            <input
              type="text"
              id="nome"
              class="form-control"
              [(ngModel)]="formData.produto.nome"
              name="nome"
              placeholder="Nome do produto"
            />
            <label for="nome">Fornecedor</label>
            <!-- FORNECEDOR -->
            <input
              type="text"
              id="fornecedor"
              class="form-control"
              [(ngModel)]="formData.produto.fornecedor"
              name="fornecedor"
              placeholder="Fornecedor"
            />
            <label for="nome">Marca</label>
            <!-- MARCA -->
            <input
              type="text"
              id="marca"
              class="form-control"
              [(ngModel)]="formData.produto.marca"
              name="marca"
              placeholder="Marca"
            />
            <label for="nome">Pre√ßo</label>
            <!-- PRE√áO UNIT√ÅRIO -->
            <input
              type="number"
              id="precoUnitario"
              class="form-control"
              [(ngModel)]="formData.produto.precoUnitario"
              name="precoUnitario"
              placeholder="0.00"
              step="0.01"
            />
            <label for="nome">Descri√ß√£o</label>
            <!-- DESCRI√á√ÉO -->
            <textarea
              id="descricao"
              class="form-control"
              [(ngModel)]="formData.produto.descricao"
              name="descricao"
              placeholder="Descri√ß√£o do produto"
              rows="3"
            ></textarea>

            <label for="quantidade">Quantidade</label>
            <input
              type="number"
              id="quantidade"
              class="form-control"
              [(ngModel)]="formData.quantidade"
              name="quantidade"
              placeholder="0"
              min="0"
            />
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="fecharFormulario()">
              Cancelar
            </button>
            <button type="button" class="btn btn-primary" (click)="salvarProduto()">
              {{ isEditMode ? 'Atualizar' : 'Adicionar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</app-layout>
