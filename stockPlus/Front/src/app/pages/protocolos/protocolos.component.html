<app-layout>
    <app-alerta
      [mensagem]="alertMensagem"
      [tipo]="alertTipo"
      [visivel]="alertVisivel">
    </app-alerta>
  <div class="protocolos-container">
    <div class="protocolos-header">
      <h1>Protocolos</h1>
      <button class="btn btn-primary" (click)="abrirFormulario()">+ Criar Protocolo</button>
    </div>

    <div *ngIf="isLoading" class="loading">
      <p>Carregando protocolos...</p>
    </div>

    <div *ngIf="erro && !isLoading" class="alert alert-danger">
      {{ erro }}
    </div>

    <div *ngIf="!isLoading && protocolos.length > 0" class="protocolos-grid">
      <div class="protocolo-card" *ngFor="let p of protocolos">
        <div class="protocolo-header-card">
          <h3>{{ p.nome }}</h3>
          <button class="btn-delete" (click)="deletarProtocolo(p)">üóëÔ∏è</button>
        </div>
        <p><strong>Pre√ßo do protocolo:</strong> R$ {{ p.preco | number:'1.2-2' }}</p>
        <p><strong>Itens:</strong> {{ p.itens.length || 0 }}</p>
        <p><strong>Custo Total:</strong> R$ {{ p.valorTotal | number:'1.2-2' }}</p>
        <button class="btn btn-primary w-100 mt-3" (click)="acessarProtocolo(p)">
          Abrir Protocolo
        </button>
      </div>
    </div>

    <div *ngIf="!isLoading && protocolos.length === 0" class="empty-state">
      <p>Nenhum protocolo cadastrado.</p>
      <button class="btn btn-primary" (click)="abrirFormulario()">Criar Primeiro Protocolo</button>
    </div>

    <div *ngIf="showFormModal" class="modal-overlay" (click)="fecharFormulario()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Criar Novo Protocolo</h3>
          <button class="btn-close" (click)="fecharFormulario()">‚úï</button>
        </div>

        <form class="modal-form">
          <div class="form-group">
            <label>Nome *</label>
            <input type="text" class="form-control" [(ngModel)]="novoProtocolo.nome" name="nome">
          </div>
          <div class="form-group">
            <label>Pre√ßo (valor cobrado ao cliente)</label>
            <input type="number" class="form-control" [(ngModel)]="novoProtocolo.preco" name="preco" step="0.01">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="fecharFormulario()">Cancelar</button>
            <button type="button" class="btn-primary" (click)="criarProtocolo()">Criar Protocolo</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</app-layout>
